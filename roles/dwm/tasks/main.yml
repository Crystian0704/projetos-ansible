- name: Remove diretório do dwm
  file:
    path: "/home/{{ usuario }}/.config/suckless/dwm"
    state: absent
  become: yes
  become_user: root

- name: Copia o arquivo autostart.sh e da permissão de execução
  copy:
    src: autostart.sh
    dest: /home/{{ usuario }}/.dwm/
    owner: "{{ usuario }}"
    group: "{{ usuario }}"
    mode: 0755

- name: Copia o arquivo dwm.desktop
  copy:
    src: dwm.desktop
    dest: /usr/share/xsessions
    owner: root
    group: root
    mode: 0644

- name: Clona o repositório do dwm-6.4
  git:
    repo: https://git.suckless.org/dwm
    dest: /home/{{ usuario }}/.config/suckless/dwm
    clone: yes
    force: yes
    version: 6.4
  become: yes
  become_user: "{{ usuario }}"

- name: Baixa os patches
  uri:
    url: "{{ item.src }}"
    dest: "/home/{{ usuario }}/.config/suckless/dwm/{{ item.filename }}"
    owner: "{{ usuario }}"
    group: "{{ usuario }}"
  loop:
    - {
        src: "https://dwm.suckless.org/patches/autostart/dwm-autostart-20161205-bb3bd6f.diff",
        filename: "dwm-autostart-20161205-bb3bd6f.diff"
      }
    - {
        src: "https://dwm.suckless.org/patches/vanitygaps/dwm-cfacts-vanitygaps-6.4_combo.diff",
        filename: "dwm-cfacts-vanitygaps-6.4_combo.diff"
      }
    - {
        src: "https://dwm.suckless.org/patches/hide_vacant_tags/dwm-hide_vacant_tags-6.3.diff",
        filename: "dwm-hide_vacant_tags-6.3.diff"
      }
    - {
        src: "https://dwm.suckless.org/patches/rotatestack/dwm-rotatestack-20161021-ab9571b.diff",
        filename: "dwm-rotatestack-20161021-ab9571b.diff"
      }
    - {
        src: "https://dwm.suckless.org/patches/statuscmd/dwm-statuscmd-20210405-67d76bd.diff",
        filename: "dwm-statuscmd-20210405-67d76bd.diff"
      }
- name: Aplica os patches
  shell: |
    cd "/home/{{ usuario }}/.config/suckless/dwm"
    patch < dwm-rotatestack-20161021-ab9571b.diff
    patch < dwm-autostart-20161205-bb3bd6f.diff
    patch < dwm-cfacts-vanitygaps-6.4_combo.diff
    patch < dwm-hide_vacant_tags-6.3.diff

- name: Copia os dwm.c e config.def.h
  copy:
    src: "{{ item.src }}"
    dest: "/home/{{ usuario }}/.config/suckless/dwm/{{ item.filename }}"
    owner: "{{ usuario }}"
    group: "{{ usuario }}"
  loop:
    - {
        src: "dwm.c",
        filename: "dwm.c"
      }
    - {
        src: "config.def.h",
        filename: "config.def.h"
      }


- name: Compila o dwm
  shell: |
    rm -rf "/usr/local/bin/dwm"
    cd "/home/{{ usuario }}/.config/suckless/dwm"
    make
    make install


