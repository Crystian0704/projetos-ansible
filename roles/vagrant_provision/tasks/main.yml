---
# tasks file for vagrant_provision
- name: Define o caminho para salvar as configurações da VM
  set_fact:
    vm_provision_path: "{{ lookup('env', 'HOME') }}/vms/{{ vm_provision_name }}"

- name: Cria o diretório para salvar as configurações da VM
  file:
    path: "{{ vm_provision_path }}"
    state: directory

- name: Destroi VMs existentes
  command: vagrant destroy -f
  args:
    chdir: "{{ vm_provision_path }}"
  become: yes
  ignore_errors: yes

- name: Remove .vagrant
  file:
    path: "{{ vm_provision_path }}/.vagrant"
    state: absent
  become: yes

- name: Cria o arquivo Vagrantfile
  template:
    src: Vagrantfile.j2
    dest: "{{ vm_provision_path }}/Vagrantfile"

- name: Provisiona VM
  command: vagrant up
  args:
    chdir: "{{ vm_provision_path }}"
